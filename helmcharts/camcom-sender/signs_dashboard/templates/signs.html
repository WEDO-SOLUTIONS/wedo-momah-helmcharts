{% extends "navbar.html" %}

{% block title %}{{ _('signs') }}{% endblock %}

{% block styles %}
    {{ super() }}
    <link id="bsdp-css" href="/static/bootstrap-datepicker3/1.9.0/bootstrap-datepicker3.min.css"
          rel="stylesheet">
    <link rel="stylesheet" href="/static/font-awesome/4.7.0/font-awesome.min.css">
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="/static/bootstrap-datepicker/1.9.0/bootstrap-datepicker.min.js"></script>
    <script src="/static/bootstrap-datepicker/1.9.0/bootstrap-datepicker.ru.min.js"
            charset="UTF-8"></script>
     <script>
        $(document).ready(function() {
            document.getElementById('nav_signs').className = 'active';

            regexButton = document.getElementById('regex_button');
            regexCheckbox = document.getElementById('regex_checkbox');

            regexButton.addEventListener("click", () => {
                if (regexButton.classList.contains("btn-default")) {
                    regexButton.classList.remove("btn-default");
                    regexButton.classList.add("btn-success");
                    regexCheckbox.checked = true;
                } else {
                    regexButton.classList.remove("btn-success");
                    regexButton.classList.add("btn-default");
                    regexCheckbox.checked = false;
                }
            });
        });
    </script>

{% endblock %}

{% block content %}
    <style>
        body {
            padding-top: 50px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }

        .table {
            text-align: left;
        }

        .row {
            margin-bottom: 20px;
        }

        .row .row {
            margin-top: 10px;
            margin-bottom: 0;
        }
    </style>
    <div class="container">
        <div class="starter-template">
            <form>
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">Label</span>
                            <input
                                name="label"
                                type="text"
                                class="form-control"
                                placeholder="..."
                                value="{{ query_params.label if query_params.label is not none else '' }}"
                            >
                           <span class="input-group-btn">
                               {% if query_params.is_regex_on %}
                                    <button id="regex_button" class="btn btn-success" type="button">.*</button>
                               {% else %}
                                    <button id="regex_button" class="btn btn-default" type="button">.*</button>
                               {% endif %}
                           </span>
                        </div>
                    </div>
                    <input id="regex_checkbox" name="is_regex" type="checkbox" hidden
                           {% if query_params.is_regex_on %}checked{% endif %}>
                    <div class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">value</span>
                            <input
                                name="sign_value"
                                type="text"
                                class="form-control"
                                placeholder="..."
                                value="{{ query_params.sign_value if query_params.sign_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">is_tmp</span>
                            <select class="form-control" name="is_tmp">
                                <option value="" {% if query_params.is_tmp is none %}selected {% endif %}>Any</option>
                                <option value="true" {% if query_params.is_tmp is not none and query_params.is_tmp %}selected {% endif %}>True</option>
                                <option value="false" {% if query_params.is_tmp is not none and not query_params.is_tmp %}selected {% endif %}>False</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">Detector name</span>
                            <input
                                name="detector_name"
                                type="text"
                                class="form-control"
                                placeholder="..."
                                value="{{ query_params.detector_name if query_params.detector_name is not none else '' }}"
                            >
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group date" data-provide="datepicker" data-date-format="dd-mm-yyyy">
                            <span class="input-group-addon">Дата от</span>
                            <input name="from_date" type="text" class="form-control" value="{{ query_params.from_date }}">
                            <div class="input-group-addon">
                                <span class="glyphicon glyphicon-th"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">prob</span>
                            <input
                                name="from_prob"
                                type="number"
                                step="0.01"
                                min="0"
                                max="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.prob_range.from_value
                                if query_params.prob_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_prob"
                            type="number"
                            step="0.01"
                            min="0"
                            max="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.prob_range.to_value
                            if query_params.prob_range.to_value is not none else '' }}"
                        >
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">width</span>
                            <input
                                name="from_width"
                                type="number"
                                step="1"
                                min="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.width_range.from_value
                                if query_params.width_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_width"
                            type="number"
                            step="1"
                            min="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.width_range.to_value
                            if query_params.width_range.to_value is not none else '' }}"
                        >
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">x_from</span>
                            <input
                                name="from_x_from"
                                type="number"
                                step="1"
                                min="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.x_from_range.from_value
                                if query_params.x_from_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_x_from"
                            type="number"
                            step="1"
                            min="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.x_from_range.to_value
                            if query_params.x_from_range.to_value is not none else '' }}"
                        >
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group date" data-provide="datepicker" data-date-format="dd-mm-yyyy">
                            <span class="input-group-addon">до</span>
                            <input name="to_date" type="text" class="form-control" value="{{ query_params.to_date }}">
                            <div class="input-group-addon">
                                <span class="glyphicon glyphicon-th"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">side prob</span>
                            <input
                                name="from_is_side_prob"
                                type="number"
                                step="0.01"
                                min="0"
                                max="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.is_side_prob_range.from_value
                                if query_params.is_side_prob_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_is_side_prob"
                            type="number"
                            step="0.01"
                            min="0"
                            max="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.is_side_prob_range.to_value
                            if query_params.is_side_prob_range.to_value is not none else '' }}"
                        >
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">height</span>
                            <input
                                name="from_height"
                                type="number"
                                step="1"
                                min="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.height_range.from_value
                                if query_params.height_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_height"
                            type="number"
                            step="1"
                            min="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.height_range.to_value
                            if query_params.height_range.to_value is not none else '' }}"
                        >
                    </div>
                    <div class="col-md-2">
                        <div class="input-group">
                            <span class="input-group-addon">y_from</span>
                            <input
                                name="from_y_from"
                                type="number"
                                step="1"
                                min="1"
                                class="form-control"
                                placeholder="from"
                                value="{{ query_params.y_from_range.from_value
                                if query_params.y_from_range.from_value is not none else '' }}"
                            >
                        </div>
                    </div>
                    <div class="col-md-1">
                        <input
                            name="to_y_from"
                            type="number"
                            step="1"
                            min="1"
                            class="form-control"
                            placeholder="to"
                            value="{{ query_params.y_from_range.to_value
                            if query_params.y_from_range.to_value is not none else '' }}"
                        >
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-1" style="float: right">
                        <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                </div>
            </form>
            {% if signs %}
                <div class="row">
                    <a href="{{ url_for("download_crops", **download_params) }}">
                        <button class="glyphicon glyphicon-save-file">Download crops</button>
                    </a>
                    <a href="{{ url_for("download_frames", **download_params) }}">
                        <button class="glyphicon glyphicon-save-file">Download frames</button>
                    </a>
                    <a href="{{ url_for("download_predictions", **download_params) }}">
                        <button class="glyphicon glyphicon-save-file">Download predictions</button>
                    </a>
                </div>
                <div class="row">
                    <table class="table table-striped table-sm">
                        <tr>
                            <th>Detector name</th>
                            <th>Label</th>
                            <th>Value</th>
                            <th>Probability</th>
                            <th>Is side</th>
                            <th>Is side probability</th>
                            <th>Is tmp</th>
                            <th>X from</th>
                            <th>Y from</th>
                            <th>Width</th>
                            <th>Height</th>
                            <th>Directions</th>
                            <th>Directions prob</th>
                            <th>Position</th>
                            <th>Кадр</th>
                            <th>Кроп</th>
                        </tr>
                        {% for sign in signs %}
                            <tr>
                                <td>{{ sign.detector_name }}</td>
                                <td>{{ sign.label }}</td>
                                <td>{{ sign.sign_value if sign.sign_value is not none else '' }}</td>
                                <td>{{ sign.prob }}</td>
                                <td>{{ sign.is_side }}</td>
                                <td>{{ sign.is_side_prob }}</td>
                                <td>{{ sign.is_tmp }}</td>
                                <td>{{ sign.x_from }}</td>
                                <td>{{ sign.y_from }}</td>
                                <td>{{ sign.width }}</td>
                                <td>{{ sign.height }}</td>
                                <td>{{ sign.directions if sign.directions is not none else '' }}</td>
                                <td>{{ sign.directions_prob if sign.directions is not none else '' }}</td>
                                <td>
                                    <a
                                        href="/map?point={{ sign.frame.lon }},{{ sign.frame.lat }}"
                                    >
                                        <i class="fa fa-map-marker"></i>
                                    </a>
                                </td>
                                <td><a href="{{ url_for("frame", frame_id=sign.frame_id) }}"><i class="fa fa-image"></i></a></td>
                                <td><a href="/crop?sign_id={{ sign.id }}"><i class="fa fa-image"></i></a></td></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
